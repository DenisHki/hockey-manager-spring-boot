<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">

<head>
<title>Player List</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link type="text/css" rel="stylesheet" href="/css/bootstrap.min.css"
	th:href="@{/css/bootstrap.min.css}" />
</head>

<body>
	<div class="container">
		<div class="d-flex justify-content-between align-items-center mb-3">
			<div>
				<i>Welcome <b sec:authentication="name"></b>, your role is <b
					sec:authentication="principal.authorities"></b>
			</div>
			<div>
				<form th:action="@{/logout}" method="post">
					<input type="submit" value="Sign Out" class="btn btn-sm btn-danger" />
				</form>
			</div>
		</div>
		
		<h1 class="text-center">Rooster:</h1>
		<form th:action="@{/playerlist}" method="get" class="mb-3">
			<div class="form-row align-items-end">
				<div class="col-sm-6">
					<label for="search">Search by Name:</label> <input type="text"
						id="search" name="search" class="form-control" />
				</div>
				<div class="col-sm-3">
					<button type="submit" class="btn btn-primary">Search</button>
				</div>
			</div>
		</form>

		<table class="table table-striped">
			<tr>
				<th>Name</th>
				<th>Number</th>
				<th>Goals</th>
				<th>Assists</th>
				<th>Points</th>
				<th>Position</th>
				<th sec:authorize="hasAuthority('ADMIN')" colspan="2">Actions</th>
			</tr>
			<tr th:each="player : ${players}">
				<td th:text="${player.name}">Name</td>
				<td th:text="${player.number}">Number</td>
				<td th:text="${player.goals}">Goals</td>
				<td th:text="${player.assists}">Assists</td>
				<td th:text="${player.points}">Points</td>
				<td th:text="${player.position.name}">Position</td>
				<td sec:authorize="hasAuthority('ADMIN')"><a href="#"
					class="btn btn-danger"
					th:attr="data-confirm='Are you sure you want to delete this player?'"
					th:data-url="@{/delete/{id}(id=${player.id})}">Delete</a></td>
				<td sec:authorize="hasAuthority('ADMIN')"><a
					th:href="@{/edit/{id}(id=${player.id})}" class="btn btn-warning">Edit</a>
				</td>
			</tr>
		</table>

		<a href="/add" class="btn btn-success">Add Player</a>

	</div>

	<!-- JavaScript code for confirmation dialog -->
	<script th:inline="text">
		function handleDeleteConfirmation(link) {
			var confirmationMessage = link.getAttribute('data-confirm');
			var url = link.getAttribute('data-url');
			if (window.confirm(confirmationMessage)) {
				// If the user confirms, follow the link
				window.location.href = url;
			}
		}

		var elementsWithConfirmation = document
				.querySelectorAll('[data-confirm]');
		elementsWithConfirmation.forEach(function(element) {
			element.addEventListener('click', function(event) {
				event.preventDefault();
				handleDeleteConfirmation(element);
			});
		});
	</script>
</body>

</html>